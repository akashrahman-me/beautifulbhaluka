package com.akash.beautifulbhaluka.presentation.screens.butchercook

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.flow.update
import kotlinx.coroutines.launch

class ButcherCookViewModel : ViewModel() {

    private val _uiState = MutableStateFlow(ButcherCookUiState())
    val uiState: StateFlow<ButcherCookUiState> = _uiState.asStateFlow()

    init {
        onAction(ButcherCookAction.LoadData)
    }

    fun onAction(action: ButcherCookAction) {
        when (action) {
            is ButcherCookAction.LoadData -> loadData()
            is ButcherCookAction.SearchQueryChanged -> updateSearchQuery(action.query)
            is ButcherCookAction.TypeFilterChanged -> updateTypeFilter(action.type)
            is ButcherCookAction.SearchExpandedChanged -> updateSearchExpanded(action.expanded)
            is ButcherCookAction.CallNumber -> {
                // Handle phone call action - can be implemented later
            }

            is ButcherCookAction.NavigateToPublish -> {
                // Navigation is handled in the UI layer
            }
        }
    }

    private fun loadData() {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }

            try {
                val butcherCooks = listOf(
                    ButcherCook("ðŸ„", "à¦¨à§à¦°à§à¦² à¦‡à¦¸à¦²à¦¾à¦®", "01709158834", "à¦¤à¦¾à¦®à¦¾à¦Ÿ à¦¬à¦¾à¦œà¦¾à¦°", "à¦•à¦¸à¦¾à¦‡"),
                    ButcherCook(
                        "ðŸ„",
                        "à¦²à§à§Žà¦«à¦° à¦°à¦¹à¦®à¦¾à¦¨",
                        "01762152244",
                        "à¦¨à¦¾à¦°à¦¾à¦™à§à¦—à¦¿ à¦‰à¦¥à§à¦°à¦¾, à¦­à¦¾à¦²à§à¦•à¦¾",
                        "à¦•à¦¸à¦¾à¦‡"
                    ),
                    ButcherCook("ðŸ§‘â€ðŸ³", "à¦œà¦¹à¦¿à¦°", "01709158834", "à¦­à¦¾à¦²à§à¦•à¦¾", "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"),
                    ButcherCook(
                        "ðŸ„",
                        "à¦¤à¦¾à¦°à¦¾ à¦®à¦¿à¦¯à¦¼à¦¾ ( à¦¤à¦¾à¦°à§‡à¦• )",
                        "à§¦à§§à§­à§ªà§«à§¯à§­à§¦à§«à§©à§ª",
                        "à¦­à¦¾à¦²à§à¦•à¦¾ à¦‰à¦ªà¦œà§‡à¦²à¦¾ à¦¸à§à¦¬à¦¾à¦¸à§à¦¥à§à¦¯ à¦•à¦®à¦ªà§à¦²à§‡à¦•à§à¦¸ à¦°à§‹à¦¡, à¦¬à§à¦°à¦¿à¦œ à¦®à§‹à¦¡à¦¼ à¦à¥¤ à¦¶à¦¾à¦¹à¦œà¦¾à¦²à¦¾à¦² à¦—à§‹à¦¸à§à¦¤à§‹ à¦¬à¦¿à¦¤à¦¾à¦¨à¥¤",
                        "à¦•à¦¸à¦¾à¦‡"
                    ),
                    ButcherCook("ðŸ§‘â€ðŸ³", "à¦œà§à¦¯à¦¼à§‡à¦²", "+880 1720-043197", "à¦®à§‡à¦¦à¦¿à¦²à¦¾", "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"),
                    ButcherCook("ðŸ„", "Mazahar", "+8801847871258", "à¦®à§à¦›à¦¾à¦° à¦­à¦¿à¦Ÿà¦¾", "à¦•à¦¸à¦¾à¦‡"),
                    ButcherCook("ðŸ„", "à¦¸à¦¾à¦‡à¦¦à§à¦° à¦•à¦¸à¦¾à¦‡", "+880 1716-854285", "à¦œà¦¾à¦®à§à¦° à¦­à¦¿à¦Ÿà¦¾", "à¦•à¦¸à¦¾à¦‡"),
                    ButcherCook("ðŸ„", "à¦†à¦ƒ à¦®à¦¤à¦¿à¦¨", "01731151630", "à¦¬à¦°à¦Ÿà¦¿à¦²à¦¾, à¦•à¦²à§‡à¦œ à¦¬à¦¾à¦œà¦¾à¦°", "à¦•à¦¸à¦¾à¦‡"),
                    ButcherCook("ðŸ§‘â€ðŸ³", "à¦®à§‹:à¦‰à¦œà§à¦œà¦² à¦®à¦¿à¦¯à¦¼à¦¾", "01791952018", "à¦°à¦¾à¦œà§ˆ à¦­à¦¾à¦²à§à¦•à¦¾", "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦®à§‹à¦ƒ à¦†à¦¬à§à¦¦à§à¦² à¦¹à¦¾à¦®à¦¿à¦¦",
                        "01708446664",
                        "à¦—à§à¦°à¦¾à¦®:à¦¨à¦¿à¦à§à¦°à§€, à¦‡à¦‰à¦¨à¦¿à¦¯à¦¼à¦¨:à¦®à§‡à¦¦à§à¦¯à¦¼à¦¾à¦°à¦¿",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦–à§‹à¦°à¦¶à§‡à¦¦ à¦†à¦²à¦® à¦–à¦¸à¦°à§",
                        "à§¦à§§à§­à§®à§©à§®à§¦à§¯à§­à§®à§¨",
                        "à¦†à¦™à§à¦—à¦¾à¦°à¦—à¦¾à¦¡à¦¼à¦¾, à¦‡à¦¸à§à¦¤à¦¾à¦°à¦˜à¦¾à¦Ÿ, à¦¡à¦¾à¦•à¦¾à¦¤à¦¿à¦¯à¦¼à¦¾, à¦­à¦¾à¦²à§à¦•à¦¾à¥¤",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦•à¦¾à¦²à¦¾à¦® à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿",
                        "à§¦à§§à§¯à§¬à§¦à§§à§¦à§¯à§¨à§ªà§¯",
                        "à¦•à¦¾à¦¶à¦° à¦¹à¦¬à¦¿à¦°à¦¬à¦¾à¦¡à¦¼à¦¿ à¦­à¦¾à¦²à§à¦•à¦¾ à¦®à¦¯à¦¼à¦®à¦¨à¦¸à¦¿à¦‚à¦¹",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook("ðŸ§‘â€ðŸ³", "à¦®à§‹ à¦«à¦¿à¦°à§‹à¦œ à¦®à¦¿à¦¯à¦¼à¦¾", "à§¦à§§à§­à§­à§§à§¯à§¦à§¯à§¨à§§à§§", "à¦ªà§à¦°à§à¦°à¦¾", "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"),
                    ButcherCook(
                        "ðŸ„",
                        "à¦¸à¦¿à¦°à¦¾à¦œà§à¦² à¦‡à¦¸à¦²à¦¾à¦® (à¦¸à¦¿à¦°à§)",
                        "+8801722260268",
                        "à¦œà¦¿à¦¬à¦¨à¦¤à¦²à¦¾,à¦¹à¦¬à¦¿à¦°à¦¬à¦¾à¦¡à¦¼à§€,à¦­à¦¾à¦²à§à¦•à¦¾,à¦®à¦¯à¦¼à¦®à¦¨à¦¸à¦¿à¦‚à¦¹",
                        "à¦•à¦¸à¦¾à¦‡"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦®à§‹ à¦¨à§à¦°à§à¦² à¦‡à¦¸à¦²à¦¾à¦®",
                        "01737575740",
                        "à¦¬à¦¾à¦à¦¶à¦¿à¦² à¦­à¦¾à¦²à§à¦•à¦¾",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦°à¦¨à¦¿ , à¦®à¦¾à¦¹à¦¿à¦®, à¦“à¦¯à¦¼à¦¾à¦²à¦¿à¦¦, à¦°à§à¦¦à§à¦°",
                        "01618062549",
                        "à¦¬à¦¾à¦à¦¶à§€à¦²",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ„",
                        "à¦¸à§‡à¦²à¦¿à¦® à¦•à¦¸à¦¾à¦‡",
                        "01776541458",
                        "à¦®à§‡à¦¦à§à¦¯à¦¼à¦¾à¦°à§€, à¦­à¦¾à¦²à§à¦•à¦¾à¥¤ à¦®à¦¾à¦‚à¦¸à¦¾ à¦•à¦¾à¦Ÿà¦¾à¦° à¦œà¦¨à§à¦¯ à¦¯à§‹à¦—à¦¾à¦¯à§‹à¦— à¦•à¦°à§à¦¨à¥¤",
                        "à¦•à¦¸à¦¾à¦‡"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦®à§‹à¦ƒ à¦–à¦¾à¦‡à¦°à§à¦² à¦‡à¦¸à¦²à¦¾à¦® (à¦¹à¦¾à¦•à§à¦•à§à¦²)",
                        "01720-450867",
                        "à¦¨à¦¾à¦°à¦¾à¦™à§à¦—à§€, à§§à¦¨à¦‚ à¦‰à¦¥à§à¦°à¦¾ à¦‡à¦‰à¦¨à¦¿à¦¯à¦¼à¦¨, à¦­à¦¾à¦²à§à¦•à¦¾, à¦®à¦¯à¦¼à¦®à¦¨à¦¸à¦¿à¦‚à¦¹à¥¤",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦®à§‹à¦ƒ à¦¸à¦¾à¦‡à¦«à§à¦² à¦‡à¦¸à¦²à¦¾à¦®",
                        "01776-622330",
                        "à¦®à§‡à¦¨à¦œà§‡à¦¨à¦¾, à§§à¦¨à¦‚ à¦‰à¦¥à§à¦°à¦¾ à¦‡à¦‰à¦¨à¦¿à¦¯à¦¼à¦¨, à¦­à¦¾à¦²à§à¦•à¦¾, à¦®à¦¯à¦¼à¦®à¦¨à¦¸à¦¿à¦‚à¦¹à¥¤",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦®à§‹à¦ƒ à¦¸à¦¾à¦‡à¦¦à§à¦² à¦‡à¦¸à¦²à¦¾à¦®",
                        "01716616697",
                        "à¦¨à¦¾à¦°à¦¾à¦™à§à¦—à§€, à§§à¦¨à¦‚ à¦‰à¦¥à§à¦°à¦¾ à¦‡à¦‰à¦¨à¦¿à¦¯à¦¼à¦¨, à¦­à¦¾à¦²à§à¦•à¦¾, à¦®à¦¯à¦¼à¦®à¦¨à¦¸à¦¿à¦‚à¦¹à¥¤",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦†à¦¬à¦¦à§à¦² à¦–à¦¾à¦²à§‡à¦•",
                        "01760-309751",
                        "à¦§à¦¾à¦‡à¦°à¦¾à¦ªà¦¾à¦¡à¦¼à¦¾ à¦­à¦¾à¦²à§à¦•à¦¾",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook("ðŸ§‘â€ðŸ³", "à¦œà¦¾à¦®à¦¾à¦¨ à¦–à¦¾à¦¨", "+8801795010248", "à¦¸à¦¾à¦¤à§‡à¦‚à¦—à¦¾ à¦­à¦¾à¦²à§à¦•à¦¾", "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦†à¦œà¦¿à¦œà§à¦² à¦¹à¦• ( à¦­à¦¾à¦²à§à¦•à¦¾ à¦ªà¦¾à¦‡à¦²à¦Ÿ à¦¸à§à¦•à§à¦²à§‡à¦° à¦šà¦¤à§à¦°à§à¦¥ à¦¶à§à¦°à§‡à¦£à§€à¦° à¦•à¦°à§à¦®à¦šà¦¾à¦°à§€ )",
                        "01312-910785",
                        "à¦­à¦¾à¦²à§à¦•à¦¾ à¦ªà§Œà¦°à¦¸à¦­à¦¾ à§§ à¦¨à¦‚ à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦•à§‹à¦Ÿà¦­à¦¬à¦¨",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦®à§‹à¦ƒ à¦¤à§‹à¦¤à¦¾ à¦®à¦¿à¦¯à¦¼à¦¾",
                        "+880 1731-208782",
                        "à¦¸à¦¿à¦¡à¦·à§à¦Ÿà§‹à¦° à¦¬à¦¾à¦œà¦¾à¦° (à¦¹à¦¬à¦¿à¦°à¦¬à¦¾à¦¡à¦¼à§€)",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦®à§‹à¦ƒ à¦†à¦‡à¦¨à§‚à¦² à¦¹à¦•",
                        "+880 1929-830450",
                        "à¦¸à¦¿à¦¡à¦·à§à¦Ÿà§‹à¦° à¦¬à¦¾à¦œà¦¾à¦° (à¦¹à¦¬à¦¿à¦°à¦¬à¦¾à¦¡à¦¼à§€)",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook("ðŸ„", "à¦¸à¦¬à§à¦œ à¦–à¦¾à¦¨", "01730162737", "à¦­à¦¾à¦²à§à¦•à¦¾ à¦¬à¦¾à¦œà¦¾à¦°", "à¦•à¦¸à¦¾à¦‡"),
                    ButcherCook(
                        "ðŸ„",
                        "à¦®à§‹à¦ƒ à¦¸à¦¬à§à¦œ à¦–à¦¾à¦¨",
                        "à§¦à§§à§­ à§©à§¦à§§à§¬à§¨à§­à§©à§­",
                        "à¦®à¦¾ à¦à¦° à¦¦à§à¦¯à¦¼à¦¾ à¦®à¦¾à¦‚à¦¸ à¦¬à¦¿à¦¤à¦°à¦£ à¥¤ à¦­à¦¾à¦²à§à¦•à¦¾ à¦®à¦§à§à¦¯ à¦¬à¦¾à¦œà¦¾à¦°à¥¤",
                        "à¦•à¦¸à¦¾à¦‡"
                    ),
                    ButcherCook("ðŸ§‘â€ðŸ³", "à¦†à¦°à¦¿à¦« à¦¸à¦°à¦•à¦¾à¦°", "+8801978-638797", "à¦•à¦¾à¦šà¦¿à¦¨à¦¾ à¦¬à¦¾à¦œà¦¾à¦°", "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦œà¦¬à§à¦¬à¦¾à¦° à¦¬à¦¾à¦¬à§à¦šà¦¿",
                        "01733418468",
                        "à§­à¦¨à¦‚ à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡ à¦Ÿà¦¿à¦¨à¦Ÿà¦¿ à¦°à§‹à¦¡ à¦­à¦¾à¦²à§à¦•à¦¾",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦®à§‹ à¦®à¦¯à¦¼à¦œà§à¦¦à§à¦¦à¦¿à¦¨",
                        "à§¦à§§à§­à§§à§¯à§¦à§­à§¯à§¯à§¬à§¦",
                        "à¦¸à¦¿à¦¡à¦¿à¦¸à§à¦Ÿà§à¦° à¦¬à¦¾à¦œà¦¾à¦°",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦®à§‹ à¦®à¦¯à¦¼à¦œà§à¦¦à§à¦¦à¦¿à¦¨ à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿",
                        "à§¦à§§à§­à§§à§¯à§¦à§­à§¯à§¯à§¬à§¦",
                        "à§§à§¦ à¦¨à¦‚ à¦¹à¦¬à¦¿à¦° à¦¬à¦¾à¦¡à¦¼à§€ à¦‡à¦‰à¦¨à¦¿à¦¯à¦¼à¦¨ à¦¸à¦¿à¦¡à¦¿à¦¸à§à¦Ÿà§à¦° à¦œà¦¿à¦¬à¦¨ à¦¤à¦²à¦¾",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ§‘â€ðŸ³",
                        "à¦®à§‹à¦ƒ à¦¶à¦¾à¦¹à§€à¦¨ à¦®à¦¿à¦¯à¦¼à¦¾",
                        "01737984779",
                        "à¦®à§‡à¦¦à§à¦¯à¦¼à¦¾à¦°à§€, à¦­à¦¾à¦²à§à¦•à¦¾ à¦®à¦¯à¦¼à¦®à¦¨à¦¸à¦¿à¦‚à¦¹",
                        "à¦¬à¦¾à¦¬à§à¦°à§à¦šà¦¿"
                    ),
                    ButcherCook(
                        "ðŸ„",
                        "à¦®à§‹: à¦†à¦¸à¦¾à¦¦à§à¦² à¦‡à¦¸à¦²à¦¾à¦®",
                        "01773338795",
                        "à¦•à¦¾à¦·à¦° à¦šà§Œà¦°à¦¾à¦¸à§à¦¤à¦¾, à¦­à¦¾à¦²à§à¦•à¦¾ ,à¦®à¦¯à¦¼à¦®à¦¨à¦¸à¦¿à¦‚à¦¹",
                        "à¦•à¦¸à¦¾à¦‡"
                    )
                )

                _uiState.update {
                    it.copy(
                        isLoading = false,
                        butcherCooks = butcherCooks,
                        filteredButcherCooks = butcherCooks
                    )
                }
            } catch (e: Exception) {
                _uiState.update {
                    it.copy(isLoading = false, error = e.message)
                }
            }
        }
    }

    private fun updateSearchQuery(query: String) {
        _uiState.update { it.copy(searchQuery = query) }
        filterData()
    }

    private fun updateTypeFilter(type: ButcherCookType) {
        _uiState.update { it.copy(selectedType = type) }
        filterData()
    }

    private fun updateSearchExpanded(expanded: Boolean) {
        _uiState.update { it.copy(isSearchExpanded = expanded) }
    }

    private fun filterData() {
        val currentState = _uiState.value
        val query = currentState.searchQuery.lowercase()
        val type = currentState.selectedType

        val filtered = currentState.butcherCooks.filter { butcherCook ->
            val matchesSearch = query.isEmpty() ||
                    butcherCook.name.lowercase().contains(query) ||
                    butcherCook.address.lowercase().contains(query) ||
                    butcherCook.type.lowercase().contains(query)

            val matchesType = type == ButcherCookType.ALL || butcherCook.type == type.value

            matchesSearch && matchesType
        }

        _uiState.update { it.copy(filteredButcherCooks = filtered) }
    }
}
